-- 1) creazione di un LOCAL USER: il suo nome coincide col nome del DB
--      normalmente, per default, il nome dell'utente deve iniziare per ##
-- Per evitare di dover usare ## nella dichiarazione dei nomi utenti, eseguiamo questa SQL Statement:

alter session set "_oracle_script"=true;

-- 2) nel caso in cui lo schema già esiste, prima di crearlo di nuovo, deve essere DROPPATO

DROP user SQL_CORSO_DB CASCADE;

-- 3) creiamo l'utente/schema SQL_CORSO_DB e gli assegniamo la PASSWORD admin
--    IDENTIFIED BY ci consente di definire la password con la quale l'utente accede al DB

CREATE user SQL_CORSO_DB IDENTIFIED BY admin;

-- 4) per ora lo SCHEMA CORRENTE è quello dell'utente SYSTEM, ossia il CDB
--    voglio invece cambiare schema corrente, perché voglio entrare nello schema di SQL_CORSO_DB
--    da quel momento in poi TUTTE le SQL STATEMENT verranno indirizzate allo schema SQL_CORSO_DB

alter session set current_schema = SQL_CORSO_DB;

-- 5) assegniamo all'utente SQL_CORSO_DB i privilegi fondamentali:
--    creare una connessione col suo DB, creare gli schema object, come tabelle, etc. 

GRANT CONNECT TO SQL_CORSO_DB;
GRANT CREATE TABLE TO SQL_CORSO_DB;
GRANT CREATE SEQUENCE TO SQL_CORSO_DB;
GRANT CREATE TRIGGER TO SQL_CORSO_DB;

-- NOTA: i due ultimi privilegi sono necessari alla creazione di CHIAVI PRIMARIE AUTO INCREMENT (IDENTITY)

-- 6) l'utente deve avere accesso illimitato ai dati del DB

ALTER USER SQL_CORSO_DB QUOTA UNLIMITED ON USERS;

-- chiave primaria composta (MFR_ID, PRODUCT_ID
-- il tipo di dato di entrambe le colonne è: STRINGA DI LUNGHEZZA FISSA (codici)

CREATE TABLE PRODUCTS (
    MFR_ID CHAR(3) NOT NULL,
    PRODUCT_ID CHAR(5) NOT NULL,
    DESCRIPTION VARCHAR2(20),
    PRICE NUMBER NOT NULL,
    QTY_ON_HAND INTEGER DEFAULT 0,
    PRIMARY KEY (MFR_ID, PRODUCT_ID));

select * from products;

CREATE TABLE CUSTOMERS (
    CUST_NUM INTEGER generated by default as identity(start with 1) not null,
    COMPANY VARCHAR2(20) NOT NULL,
    CUST_REP INTEGER,
    CREDIT_LIMIT NUMBER default 1000.0,
    PRIMARY KEY (CUST_NUM));

CREATE TABLE OFFICES (
    OFFICE INTEGER generated by default as identity(start with 1) not null,
    CITY VARCHAR2(15) NOT NULL,
    REGION VARCHAR2(10) NOT NULL,
    MGR INTEGER,
    TARGET NUMBER,
    SALES NUMBER NOT NULL,
    PRIMARY KEY (OFFICE));

CREATE TABLE SALESREPS (
    EMPL_NUM INTEGER  generated by default as identity(start with 1) not null,
    NAME VARCHAR2(15) NOT NULL,
    AGE INTEGER,
    REP_OFFICE INTEGER,
    TITLE VARCHAR2(10),
    HIRE_DATE DATE NOT NULL,
    MANAGER INTEGER,
    QUOTA NUMBER,
    SALES NUMBER NOT NULL,
    PRIMARY KEY (EMPL_NUM),
    CONSTRAINT WORKSIN FOREIGN KEY (REP_OFFICE) REFERENCES OFFICES (OFFICE) ON DELETE SET NULL);

CREATE TABLE ORDERS (
    ORDER_NUM INTEGER NOT NULL,
    ORDER_DATE DATE NOT NULL,
    CUST INTEGER NOT NULL,
    REP INTEGER NOT NULL,
    MFR CHAR(3) NOT NULL,
    PRODUCT CHAR(5) NOT NULL,
    QTY INTEGER NOT NULL,
    AMOUNT NUMBER NOT NULL,
    PRIMARY KEY (ORDER_NUM),
    CONSTRAINT PLACEDBY FOREIGN KEY (CUST) REFERENCES CUSTOMERS (CUST_NUM) ON DELETE CASCADE,
    CONSTRAINT TAKENBY FOREIGN KEY (REP) REFERENCES SALESREPS (EMPL_NUM) ON DELETE SET NULL,
    CONSTRAINT ISFOR FOREIGN KEY (MFR, PRODUCT) REFERENCES PRODUCTS (MFR_ID, PRODUCT_ID)); --ON DELETE RESTRICT

ALTER TABLE CUSTOMERS ADD CONSTRAINT HASREP FOREIGN KEY (CUST_REP) REFERENCES SALESREPS (EMPL_NUM) ON DELETE SET NULL;
ALTER TABLE OFFICES ADD CONSTRAINT HASMGR FOREIGN KEY (MGR) REFERENCES SALESREPS (EMPL_NUM) ON DELETE SET NULL;
ALTER TABLE SALESREPS ADD CONSTRAINT HAS_MGR FOREIGN KEY (MANAGER) REFERENCES SALESREPS (EMPL_NUM) ON DELETE SET NULL;

INSERT INTO products VALUES ('REI', '2A45C',	'Ratchet Link',	79.00, 210) ;
INSERT INTO products VALUES ('ACI', '4100Y',	'Widget Remover', 2750.00, 25) ;
INSERT INTO products VALUES ('QSA', 'XK47',	'Reducer', 355.00, 38) ;
INSERT INTO products VALUES ('BIC', '41672',	'Plate', 180.00, 0) ;
INSERT INTO products VALUES ('IMM', '779C',	'900-lb Brace',	1875.0, 9) ;
INSERT INTO products VALUES ('ACI', '41003',	'Size 3 Widget', 107.00, 207) ;
INSERT INTO products VALUES ('ACI', '41004',	'Size 4 Widget', 117.00, 139) ;
INSERT INTO products VALUES ('BIC', '41003',	'Handle',	652.00, 3) ;
INSERT INTO products VALUES ('IMM', '887P',	'Brace Pin', 250.00, 24) ;
INSERT INTO products VALUES ('QSA', 'XK48',	'Reducer',	134.00, 203) ;
INSERT INTO products VALUES ('REI', '2A44L',	'Left Hinge', 4500.00, 12) ;
INSERT INTO products VALUES ('FEA', '112',	'Housing',	148.00, 115) ;
INSERT INTO products VALUES ('IMM', '887H',	'Brace Holder',	54.00, 223) ;
INSERT INTO products VALUES ('BIC', '41089',	'Retainer',	225.00, 78) ;
INSERT INTO products VALUES ('ACI', '41001',	'Size 1 Widget', 55.00, 277) ;
INSERT INTO products VALUES ('IMM', '775C',	'500-lb Brace',	1425.00, 5) ;
INSERT INTO products VALUES ('ACI', '4100Z',	'Widget Installer', 2500.00, 28) ;
INSERT INTO products VALUES ('QSA', 'XK48A',	'Reducer',	177.00, 37) ;
INSERT INTO products VALUES ('ACI', '41002',	'Size 2 Widget', 76.00, 167) ;
INSERT INTO products VALUES ('REI', '2A44R',	'Right Hinge', 4500.00, 12) ;
INSERT INTO products VALUES ('IMM', '773C',	'300-lb Brace',	975.00, 28) ;
INSERT INTO products VALUES ('ACI', '4100X',	'Widget Adjuster', 25.00, 37) ;
INSERT INTO products VALUES ('FEA', '114X',	'Motor Mount',	243.00, 15) ;
INSERT INTO products VALUES ('IMM', '887X',	'Brace Retainer',	475.00, 32) ;
INSERT INTO products VALUES ('REI', '2A44G',	'Hinge Pin', 350.00, 14) ;

select * from products;

ALTER TABLE CUSTOMERS MODIFY CUST_NUM INTEGER generated by default as identity(start with 2101) not null;


INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Jones Mfg.', 65000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('First Corp.', 65000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Acme Mf g.', 50000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Orion Corp.', 20000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('AAA Investments', 45000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Fred Lewis Corp.', 65000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Ace International', 35000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Holm and Landis', 55000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Chen Associates', 25000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Rico Enterprises', 50000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('JPC Inc.', 50000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Zetacorp', 50000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Ian and Schmidt', 20000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Peter Brothers', 40000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Smithson Corp.', 20000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('QMA Assoc.', 45000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('J.P. Sinclair', 35000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Midwest Systems', 60000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Solomon Inc.', 25000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Carter and Sons', 40000.00);
INSERT INTO customers (COMPANY, CREDIT_LIMIT) VALUES ('Three-Way Lines', 30000.00);

select * from SQL_CORSO_DB.customers;
select * from salesreps;

ALTER TABLE salesreps MODIFY EMPL_NUM INTEGER  generated by default as identity(start with 101) not null;

INSERT INTO salesreps (NAME, AGE, TITLE, HIRE_DATE, QUOTA, SALES) VALUES ('Dan Roberts', 45, 'Sales Rep', '20-OTT-86', 300000.00, 305673.00);
INSERT INTO salesreps (NAME, AGE, TITLE, HIRE_DATE, QUOTA, SALES) VALUES ('Sue Smith', 48, 'Sales Rep', '10-DIC-86', 350000.00, 474050.00);
INSERT INTO salesreps (NAME, AGE, TITLE, HIRE_DATE, QUOTA, SALES) VALUES ('Paul Cruz', 29, 'Sales Rep', '01-MAR-87', 275000.00, 286775.00);
INSERT INTO salesreps (NAME, AGE, TITLE, HIRE_DATE, QUOTA, SALES) VALUES ('Bob Smith', 33, 'Sales Mgr', '19-MAG-87', 200000.00, 142594.00);
INSERT INTO salesreps (NAME, AGE, TITLE, HIRE_DATE, QUOTA, SALES) VALUES ('Bill Adams', 37, 'Sales Rep', '12-FEB-88', 350000.00, 367911.00);
INSERT INTO salesreps (NAME, AGE, TITLE, HIRE_DATE, QUOTA, SALES) VALUES ('Sam Clark', 52, 'VP Sales', '14-GIU-88', 275000.00, 299912.00);
INSERT INTO salesreps (NAME, AGE, TITLE, HIRE_DATE, QUOTA, SALES) VALUES ('Nancy Angelli', 49, 'Sales Rep', '14-NOV-88', 300000.00, 186042.00);
INSERT INTO salesreps (NAME, AGE, TITLE, HIRE_DATE, QUOTA, SALES) VALUES ('Larry Fitch', 62, 'Sales Mgr', '12-OTT-89', 350000.00, 361865.00);
INSERT INTO salesreps (NAME, AGE, TITLE, HIRE_DATE, QUOTA, SALES) VALUES ('Mary Jones', 31, 'Sales Rep', '12-OTT-89', 300000.00, 392725.00);
INSERT INTO salesreps (NAME, AGE, TITLE, HIRE_DATE, QUOTA, SALES) VALUES ('Tom Snyder', 41, 'Sales Rep', '13-GEN-90', NULL, 75985.00);

select * from salesreps;

ALTER TABLE offices MODIFY OFFICE INTEGER generated by default as identity(start with 11) not null;

ALTER TABLE offices MODIFY SALES NUMBER default 0.0;

INSERT INTO offices (CITY, REGION, TARGET, SALES) VALUES ('New York', 'Eastern', 575000.00, 692637.00);
INSERT INTO offices (CITY, REGION, TARGET, SALES) VALUES ('Chicago', 'Eastern', 800000.00, 735042.00);
INSERT INTO offices (CITY, REGION, TARGET, SALES) VALUES ('Atlanta', 'Eastern', 350000.00, 367911.00);
INSERT INTO offices (CITY, REGION, TARGET, SALES) VALUES ('Denver', 'Western', 300000.00, 186042.00);
INSERT INTO offices (CITY, REGION, TARGET, SALES) VALUES ('Los Angeles', 'Western', 725000.00, 835915.00);

select * from offices;


select * from salesreps;

UPDATE salesreps SET REP_OFFICE = 13, MANAGER = 104 WHERE EMPL_NUM = 105;
UPDATE salesreps SET REP_OFFICE = 11, MANAGER = 106 WHERE EMPL_NUM = 109;
UPDATE salesreps SET REP_OFFICE = 15, MANAGER = 108 WHERE EMPL_NUM = 102;
UPDATE salesreps SET REP_OFFICE = 11, MANAGER = NULL WHERE EMPL_NUM = 106;
UPDATE salesreps SET REP_OFFICE = 12, MANAGER = 106 WHERE EMPL_NUM = 104;
UPDATE salesreps SET REP_OFFICE = 12, MANAGER = 104 WHERE EMPL_NUM = 101;
UPDATE salesreps SET REP_OFFICE = NULL, MANAGER = 101 WHERE EMPL_NUM = 110;
UPDATE salesreps SET REP_OFFICE = 15, MANAGER = 106 WHERE EMPL_NUM = 108;
UPDATE salesreps SET REP_OFFICE = 12, MANAGER = 104 WHERE EMPL_NUM = 103;
UPDATE salesreps SET REP_OFFICE = 14, MANAGER = 108 WHERE EMPL_NUM = 107;

INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (112961, '17-DIC-89', 2117, 106, 'REI', '2A44L', 7, 31500.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113012, '11-GEN-90', 2111, 105, 'ACI', '41003', 35, 3745.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (112989, '03-GEN-90', 2101, 106, 'FEA', '114X', 6, 1458.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113051, '10-FEB-90', 2118, 108, 'QSA', 'XK47', 4, 1420.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (112968, '12-OTT-89', 2102, 101, 'ACI', '41004', 34, 3978.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113036, '30-GEN-90', 2107, 110, 'ACI', '4100Z', 9, 22500.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113045, '02-FEB-90', 2112, 108, 'REI', '2A44R', 10, 45000.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (112963, '17-DIC-89', 2103, 105, 'ACI', '41004', 28, 3276.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113013, '14-GEN-90', 2118, 108, 'BIC', '41003', 1, 652.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113058, '23-FEB-90', 2108, 109, 'FEA', '112', 10, 1480.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (112997, '08-GEN-90', 2114, 107, 'BIC', '41003', 1, 652.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (112983, '27-DIC-89', 2103, 105, 'ACI', '41004', 6, 702.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113024, '20-GEN-90', 2104, 108, 'QSA', 'XK47', 20, 7100.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113062, '24-FEB-90', 2114, 107, 'FEA', '114X', 10, 2430.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (112979, '12-OTT-89', 2104, 102, 'ACI', '4100Z', 6, 15000.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113027, '22-GEN-90', 2103, 105, 'ACI', '41002', 54, 4104.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113007, '08-GEN-90', 2112, 108, 'IMM', '773C', 3, 2925.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113069, '02-MAR-90', 2109, 107, 'IMM', '775C', 22, 31350.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113034, '29-GEN-90', 2107, 110, 'REI', '2A45C', 8, 632.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (112992, '04-NOV-89', 2118, 108, 'ACI', '41002', 10, 760.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (112975, '12-OTT-89', 2111, 103, 'REI', '2A44G', 6, 2100.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113055, '15-FEB-90', 2108, 101, 'ACI', '4100X', 6, 150.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113048, '10-FEB-90', 2110, 102, 'IMM', '779C', 2, 3750.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (112993, '04-GEN-89', 2106, 102, 'REI', '2A45C', 24, 1896.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113065, '27-FEB-90', 2106, 102, 'QSA', 'XK47', 6, 2130.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113003, '25-GEN-90', 2108, 109, 'IMM', '779C', 3, 5625.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113049, '10-FEB-90', 2118, 108, 'QSA', 'XK47', 2, 776.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (112987, '31-DIC-89', 2103, 105, 'ACI', '4100Y', 11, 27500.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113057, '18-FEB-90', 2111, 103, 'ACI', '4100X', 24, 600.00);
INSERT INTO orders (ORDER_NUM, ORDER_DATE, CUST, REP, MFR, PRODUCT, QTY, AMOUNT) VALUES (113042, '02-FEB-90', 2113, 101, 'REI', '2A44R', 5, 22500.00);

select * from orders;

UPDATE customers SET CUST_REP = 103 WHERE CUST_NUM = 2111;
UPDATE customers SET CUST_REP = 101 WHERE CUST_NUM = 2102;
UPDATE customers SET CUST_REP = 105 WHERE CUST_NUM = 2103;
UPDATE customers SET CUST_REP = 102 WHERE CUST_NUM = 2120;
UPDATE customers SET CUST_REP = 110 WHERE CUST_NUM = 2107;
UPDATE customers SET CUST_REP = 101 WHERE CUST_NUM = 2115;
UPDATE customers SET CUST_REP = 106 WHERE CUST_NUM = 2101;
UPDATE customers SET CUST_REP = 108 WHERE CUST_NUM = 2112;
UPDATE customers SET CUST_REP = 103 WHERE CUST_NUM = 2116;
UPDATE customers SET CUST_REP = 102 WHERE CUST_NUM = 2104;
UPDATE customers SET CUST_REP = 107 WHERE CUST_NUM = 2114;
UPDATE customers SET CUST_REP = 109 WHERE CUST_NUM = 2108;
UPDATE customers SET CUST_REP = 106 WHERE CUST_NUM = 2117;
UPDATE customers SET CUST_REP = 105 WHERE CUST_NUM = 2121;
UPDATE customers SET CUST_REP = 102 WHERE CUST_NUM = 2110;
UPDATE customers SET CUST_REP = 102 WHERE CUST_NUM = 2106;
UPDATE customers SET CUST_REP = 109 WHERE CUST_NUM = 2119;
UPDATE customers SET CUST_REP = 108 WHERE CUST_NUM = 2118;
UPDATE customers SET CUST_REP = 104 WHERE CUST_NUM = 2113;
UPDATE customers SET CUST_REP = 103 WHERE CUST_NUM = 2109;
UPDATE customers SET CUST_REP = 101 WHERE CUST_NUM = 2105;

select * from customers;

UPDATE offices SET MGR = 108 WHERE OFFICE = 14;
UPDATE offices SET MGR = 106 WHERE OFFICE = 11;
UPDATE offices SET MGR = 104 WHERE OFFICE = 12;
UPDATE offices SET MGR = 105 WHERE OFFICE = 13;
UPDATE offices SET MGR = 108 WHERE OFFICE = 15;

select * from offices;





